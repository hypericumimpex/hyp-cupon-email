jQuery(function(e){e("body").on("click","button.ywces-send-test-email",function(){var s=e(this).next(),a=e(this).prev().attr("value"),d=e(this).prev().attr("id").replace("ywces_test_",""),i=e("#ywces_mail_template").val()||"base",n="",t="",c="",l="",_="",o="0"!=ywces_admin.vendor_id?"_"+ywces_admin.vendor_id:"";if(s.show(),s.removeClass("send-progress send-fail send-success"),/^(([^<>()[\]\\.,;:\s@\"]+(\.[^<>()[\]\\.,;:\s@\"]+)*)|(\".+\"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/.test(a)){switch(d){case"purchases":case"spending":var r=e("#ywces_thresholds_"+d+o);if(0==r.find("tr.threshold").size())return s.addClass("send-fail"),void s.html(ywces_admin.test_mail_no_threshold);r.find("tr.threshold").each(function(){var s=e(this).find(".ywces-threshold-coupon").val(),a=e(this).find(".ywces-threshold-amount").val();""!=s&&(n=s,t=a)});break;case"product_purchasing":case"birthday":case"last_purchase":if("product_purchasing"==d){if(""==(c=e("#ywces_targets_product_purchasing"+o).val()))return s.addClass("send-fail"),void s.html(ywces_admin.test_mail_no_product)}else if("last_purchase"==d&&""==(_=e("#ywces_days_last_purchase"+o).val()))return s.addClass("send-fail"),void s.html(ywces_admin.test_mail_days_elapsed);var m=e("#ywces_coupon_"+d+"_settings"+o);if(""==m.find(".ywces-coupon-amount").val())return s.addClass("send-fail"),void s.html(ywces_admin.test_mail_no_amount);l={discount_type:m.find(".ywces-discount-type").val(),coupon_amount:m.find(".ywces-coupon-amount").val(),expiry_days:m.find(".ywces-expiry-days").val(),minimum_amount:m.find(".ywces-minimum-amount").val(),maximum_amount:m.find(".ywces-maximum-amount").val(),free_shipping:m.find(".ywces-free-shipping").is(":checked")?"yes":"",individual_use:m.find(".ywces-individual-use").is(":checked")?"yes":"",exclude_sale_items:m.find(".ywces-exclude-sale-items").is(":checked")?"yes":""};break;default:n=e("#ywces_coupon_"+d+o).val()}var u={action:"ywces_send_test_mail",email:a,type:d,coupon:n,threshold:t,template:i,products:c,coupon_info:l,days_elapsed:_,vendor_id:"0"!=ywces_admin.vendor_id?ywces_admin.vendor_id:""};s.addClass("send-progress"),s.html(ywces_admin.before_send_test_email),e.post(ywces_admin.ajax_url,u,function(e){s.removeClass("send-progress"),!0===e?(s.addClass("send-success"),s.html(ywces_admin.after_send_test_email)):(s.addClass("send-fail"),s.html(e.error))})}else s.addClass("send-fail"),s.html(ywces_admin.test_mail_wrong)})});
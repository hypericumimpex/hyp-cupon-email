jQuery(function(e){e("body").on("click","button.ywces-send-test-email",function(){var s=e(this).next(),a=e(this).prev().attr("value"),i=e(this).prev().attr("id").replace("ywces_test_",""),t=e("#ywces_mail_template").val()||"base",n="",d="",c="",l="",o="",r="0"!==ywces_admin.vendor_id?"_"+ywces_admin.vendor_id:"";if(s.show(),s.removeClass("send-progress send-fail send-success"),/^(([^<>()[\]\\.,;:\s@\"]+(\.[^<>()[\]\\.,;:\s@\"]+)*)|(\".+\"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/.test(a)){switch(i){case"purchases":case"spending":var _=e("#ywces_thresholds_"+i+r);if(0===_.find("tr.threshold").size())return s.addClass("send-fail"),void s.html(ywces_admin.test_mail_no_threshold);_.find("tr.threshold").each(function(){var s=e(this).find(".ywces-threshold-coupon").val(),a=e(this).find(".ywces-threshold-amount").val();""!==s&&(n=s,d=a)});break;case"product_purchasing":case"birthday":case"last_purchase":if("product_purchasing"===i){if(""===(c=e("#ywces_targets_product_purchasing"+r).val()))return s.addClass("send-fail"),void s.html(ywces_admin.test_mail_no_product)}else if("last_purchase"===i&&""===(o=e("#ywces_days_last_purchase"+r).val()))return s.addClass("send-fail"),void s.html(ywces_admin.test_mail_days_elapsed);var m=e("#ywces_coupon_"+i+"_settings"+r);if(""===m.find(".ywces-coupon-amount").val())return s.addClass("send-fail"),void s.html(ywces_admin.test_mail_no_amount);l={discount_type:m.find(".ywces-discount-type").val(),coupon_amount:m.find(".ywces-coupon-amount").val(),expiry_days:m.find(".ywces-expiry-days").val(),minimum_amount:m.find(".ywces-minimum-amount").val(),maximum_amount:m.find(".ywces-maximum-amount").val(),free_shipping:m.find(".ywces-free-shipping").is(":checked")?"yes":"",individual_use:m.find(".ywces-individual-use").is(":checked")?"yes":"",exclude_sale_items:m.find(".ywces-exclude-sale-items").is(":checked")?"yes":""};break;default:n=e("#ywces_coupon_"+i+r).val()}var u={action:"ywces_send_test_mail",email:a,type:i,coupon:n,threshold:d,template:t,products:c,coupon_info:l,days_elapsed:o,vendor_id:"0"!==ywces_admin.vendor_id?ywces_admin.vendor_id:""};s.addClass("send-progress"),s.html(ywces_admin.before_send_test_email),e.post(ywces_admin.ajax_url,u,function(e){s.removeClass("send-progress"),!0===e?(s.addClass("send-success"),s.html(ywces_admin.after_send_test_email)):(s.addClass("send-fail"),s.html(e.error))})}else s.addClass("send-fail"),s.html(ywces_admin.test_mail_wrong)}).on("click","button.ywces-purge-coupon",function(){var s=e(".ywces-clear-result");s.show(),e(this).hide(),e.post(ywces_admin.ajax_url,{action:"ywces_clear_expired_coupons"},function(e){s.removeClass("clear-progress"),e.success?(s.addClass("clear-success"),s.html(e.message)):(s.addClass("clear-fail"),s.html(e.error))})}),e(document).ready(function(e){var s=e(".ywces-collapse");s.each(function(){e(this).toggleClass("expand").nextUntil("tr.ywces-collapse").slideToggle(100)}),s.click(function(){e(this).toggleClass("expand").nextUntil("tr.ywces-collapse").slideToggle(100)}),e("#ywces_mail_template_enable").change(function(){e(this).is(":checked")?(e("#ywces_mail_template").val("base").prop("disabled",!0),e(".ywces-mailskin").hide()):(e("#ywces_mail_template").prop("disabled",!1),e(".ywces-mailskin").show())}).change()})});